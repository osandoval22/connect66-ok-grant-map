<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Oklahoma Cities Map (Baked)</title>

  <!-- Leaflet -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

  <style>
    body { margin: 0; font-family: system-ui, Arial, sans-serif; }
    .wrap { padding: 16px; }
    #map { height: 78vh; min-height: 420px; border-radius: 16px; }
    .status { position: fixed; top: 12px; right: 12px; background:#fff; border:1px solid #ddd;
              padding: 6px 10px; border-radius: 8px; font-size: 12px; box-shadow: 0 2px 6px rgba(0,0,0,.06); }
  </style>
</head>
<body>
  <div class="wrap">
    <h1>Oklahoma Cities Map (Baked)</h1>
    <div id="map"></div>
  </div>
  <div class="status" id="status">Loadingâ€¦</div>

  <script>
    const map = L.map('map').setView([35.5, -97.5], 6);
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
      attribution: '&copy; OpenStreetMap contributors', maxZoom: 19
    }).addTo(map);

    const statusEl = document.getElementById('status');

    fetch('./assets/cities.baked.json')
      .then(r => { if (!r.ok) throw new Error('Could not load assets/cities.baked.json'); return r.json(); })
      .then(rows => {
        const pts = rows.map(row => ({
          city:  row.city ?? row.City ?? row.name ?? row.Name ?? '',
          state: row.state ?? row.State ?? '',
          lat:   Number(row.lat ?? row.latitude),
          lon:   Number(row.lon ?? row.lng ?? row.longitude)
        })).filter(p => Number.isFinite(p.lat) && Number.isFinite(p.lon));

        statusEl.textContent = `Loaded ${pts.length} locations`;
        if (!pts.length) return;

        const bounds = [];
        pts.forEach(p => {
          L.marker([p.lat, p.lon])
            .addTo(map)
            .bindPopup(`<strong>${p.city}, ${p.state}</strong><br>Lat ${p.lat.toFixed(5)}, Lng ${p.lon.toFixed(5)}`);
          bounds.push([p.lat, p.lon]);
        });
        map.fitBounds(bounds, { padding: [30, 30] });
      })
      .catch(err => { statusEl.textContent = `Error: ${err.message}`; console.error(err); });
  </script>
</body>
</html>
