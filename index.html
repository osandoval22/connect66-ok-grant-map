<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Connect66 Gateway Towers — Statewide Route 66 Infrastructure for the 2026 Centennial</title>

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/leaflet@1.9.4/dist/leaflet.css"/>
<script src="https://cdn.jsdelivr.net/npm/leaflet@1.9.4/dist/leaflet.js"></script>

<style>
:root{--brand:#0f172a;--accent:#f59e0b;--ink:#111827}
*{box-sizing:border-box} body{margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;color:var(--ink)}
.brand{background:linear-gradient(135deg,var(--brand),#1f2937);color:#fff;border-bottom:4px solid var(--accent)}
.brand-inner{max-width:1200px;margin:0 auto;padding:20px 16px}
.brand h1{margin:0 0 6px;font-weight:800} .tagline{margin:0 0 10px;opacity:.95}
.wrap{max-width:1200px;margin:0 auto;padding:16px}
#map{height:74vh;min-height:420px;border-radius:16px;background:#f8fafc}
.status{position:fixed;top:12px;right:12px;background:#fff;border:1px solid #ddd;padding:8px 10px;border-radius:8px;font-size:12px;box-shadow:0 2px 6px rgba(0,0,0,.06)}
</style>
</head>
<body>
<header class="brand">
  <div class="brand-inner">
    <h1>Connect66 Gateway Towers — Statewide Route 66 Infrastructure for the 2026 Centennial</h1>
    <p class="tagline">44 on-route communities delivering public Wi-Fi, heritage storytelling, ribbon-cuttings, and measurable tourism impact.</p>
  </div>
</header>

<div class="wrap"><div id="map"></div></div>
<div class="status" id="status">Loading…</div>

<script>
(function(){
  // show any runtime error plainly
  const statusEl = document.getElementById('status');
  const fail = msg => { statusEl.textContent = 'Error: ' + msg; };

  // 1) base map
  if (!window.L) return fail('Leaflet failed to load');
  const map = L.map('map').setView([35.5,-97.5], 6);
  L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
    attribution:'&copy; OpenStreetMap contributors', maxZoom: 19
  }).addTo(map);

  // 2) fetch & plot baked cities (only dependency to render)
  fetch('./assets/cities.baked.json', {cache:'no-cache'})
    .then(r => { if(!r.ok) throw new Error('Could not load assets/cities.baked.json'); return r.json(); })
    .then(rows => {
      const pts = rows.map(row => ({
        city: row.city ?? row.City ?? '',
        state: row.state ?? row.State ?? 'OK',
        lat: Number(row.lat ?? row.latitude),
        lon: Number(row.lon ?? row.lng ?? row.longitude)
      })).filter(p => Number.isFinite(p.lat) && Number.isFinite(p.lon));

      if (!pts.length) throw new Error('No coordinates in cities.baked.json');

      const bounds = [];
      pts.forEach(p => {
        L.marker([p.lat,p.lon]).addTo(map)
          .bindPopup(`<strong>${p.city}, ${p.state}</strong><br>Lat ${p.lat.toFixed(5)}, Lng ${p.lon.toFixed(5)}`);
        bounds.push([p.lat,p.lon]);
      });
      map.fitBounds(bounds, {padding:[30,30]});
      statusEl.textContent = `Plotted ${pts.length} locations`;

      // 3) OPTIONAL: try to load population; ignore if bad/missing
      fetch('./assets/population.json', {cache:'no-cache'})
        .then(r => r.ok ? r.json() : {})
        .then(() => {/* intentionally no-op here to keep this minimal */})
        .catch(()=>{ /* ignore */ });
    })
    .catch(err => fail(err.message));
})();
</script>
</body>
</html>
